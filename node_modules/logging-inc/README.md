#logging-inc
[![Build Status](https://ebayci.qa.ebay.com/CI-Instance/buildStatus/icon?job=logging-inc)](https://ebayci.qa.ebay.com/CI-Instance/job/logging-inc) [![Dependency Status](https://nodevalid-i3ey5.vip.lvs01.dev.ebayc3.com/nodejs/logging-inc.svg)](https://nodevalid-i3ey5.vip.lvs01.dev.ebayc3.com/nodejs/logging-inc)  [![Code Coverage](https://nodevalid-i3ey5.vip.lvs01.dev.ebayc3.com/coverage/nodejs/logging-inc)](http://sonar/dashboard/index?id=logging-inc)


The module provides a simple API to do CAL logging as well as console output if enabled.
It is based on [cal module](https://github.corp.ebay.com/nodejs/node-cal).

On top of CAL it allows to configure logging based on log levels.

## Changelog

See   [CHANGELOG.MD](https://github.corp.ebay.com/nodejs/logging-inc/blob/master/CHANGELOG.md#changelog)

Install
```bash
$ npm install --save logging-inc --registry http://npm.corp.ebay.com/
```

Usage
```javascript
var logger = require('logging-inc').logger('myapp:viewitem');
```

## Configuration

Since the module is based on CAL, you might want to look at [CAL configuration](https://github.corp.ebay.com/nodejs/node-cal).
You can configure logger for specific log levels using '*' or regular expressions separated by commas.
The names used for configuring log levels can be parts of logger name. You can use complex name, like: myapp:viewitem:findItems and then use * to enable groups: info=myapp:*

```js
    "cal": {
        "enableBuffering": false|true
    }
    "logging-inc": {
        "loglevel": {
            "warn": "*",    // log warn, error, fatal, trasnactions
            "info": "app1:item,app1:view", // log only for app1:item and app1:view
            "debug": "app1:item*"    // enable debug for loggers with name that starts with app1:item
        }
    }
```
The available log level options are below. The options override the options bellow (i.e. if info=* then all options below will also be equal to '*')
```
debug
info
warn
error
fatal
transaction
```
By default the logging is configured as "warn": "*".

## API

* logger.debug([format, ]data1, data2, data3, ...)
The method creates debug event with type='Debug'
```javascript
logger.debug('Hello %s %s', 'John', 'Doe'); // Hello John Doe
// or
logger.debug('Hello', 'John', 'Doe'); // Hello John Doe
```

* logger.info([format, ]data1, data2, data3, ...)
The method creates info event with type='Info'
```javascript
logger.info('Hello %s %s', 'John', 'Doe'); // Hello John Doe
// or
logger.info('Hello', 'John', 'Doe'); // Hello John Doe
```

* logger.warn([[format, ]data1, data2, data3, ..., ]error)
The method creates warn event with type='Warn'
It will use 0 for CAL status field.
```javascript
logger.warn('Failed to read attribute "%s" from %s',
    'items', 'http://shopping.vip.ebay.com', new Error('Test error'));
// produces message='Failed to read attribute "items" from
//  http://shopping.vip.ebay.com to read attribute' with error and status=0
```

* logger.error([[format, ]data1, data2, data3, ..., ]error)
The method creates error event with type='Error'
It will use error.code or error.statusCode or 1 for CAL status field.
```javascript
logger.error('Failed to read attribute "%s" from %s', 'items',
    'http://shopping.vip.ebay.com', new Error('Test error'));
// produces message='Failed to read attribute "items"
//  from http://shopping.vip.ebay.com to read attribute' with error and status=1
// or
var error = new Error('Test error');
error.code = '404';
logger.error('Failed to read attribute "%s" from %s',
    'items', 'http://shopping.vip.ebay.com', error);
// will produce message='Failed to read attribute "items" from
//  http://shopping.vip.ebay.com to read attribute' with error and status=404
// or you can just log error
logger.error(new Error('Test error'));
// will produce message='Test error' with error and status=1
```

* logger.fatal([[format, ]data1, data2, data3, ..., ]error)
The method creates fatal event with type='Fatal'
It will use error.code or error.statusCode or 1 for CAL status field.
```javascript
logger.fatal('Failed to read attribute "%s" from %s', 'items',
    'http://shopping.vip.ebay.com', new Error('Test error'));
// produces message='Failed to read attribute "items"
//  from http://shopping.vip.ebay.com to read attribute' with error and status=1
// or
var error = new Error('Test error');
error.code = '404';
logger.fatal('Failed to read attribute "%s" from %s',
    'items', 'http://shopping.vip.ebay.com', error);
// Produces message='Failed to read attribute "items"
//  from http://shopping.vip.ebay.com to read attribute' with error and status=404
```

### Transaction support
The logger supports nested transactions based on CAL functionality.

* logger.begin(type, name, callback)
The method starts transaction and returns transaction object in callback

```javascript
var logger = require('logging-inc').logger('myapp:viewitem');

logger.begin('TxType', 'TxName', function(transaction) {
    logger.warn('tx-warn-test', 'tx warning message');
    logger.error('tx-error-test', new Error('Tx test error'));

    setTimeout(function () {
        transaction.fail('tx fail', new Error('TX test error fail'));
        // or transaction.end(); // successful completion
    }, 40);
});
```

### Transaction API
#### transaction.end()
Successfully ends transaction with status code = 0.

#### transaction.fail(message, error[, status, data])
Marks transaction as failed with error.code or error.statusCode or 1 for CAL status field.

### Custom appenders API
#### module.configure(config)
The appender must export 'configure' method that will configure appender and return function that will consume log event.

```javascript
module.exports.configure = function configure(config) {
    return function consume(evt) {
        console.log(evt);
    }
}
```
