'use strict';

module.exports = function globalHeaderTag(input, out) {
    var globalHeader = out.global.globalHeader;

    if (!globalHeader) {
        throw new Error('Global header not configured. The <gh-configure> tag (Marko Templates) or {@gh-configure/} helper (Dust) should be included near the beginning.'); // eslint-disable-line max-len
    }

    var footerAsyncValue = globalHeader.footer;
    if (footerAsyncValue.isResolved()) {
        footerAsyncValue.data.renderAMP(out);
        return;
    }

    var asyncOut = out.beginAsync();
    footerAsyncValue.done(function(err, footer) {
        if (err) {
            return asyncOut.error(err);
        }

        footer.renderAMP(asyncOut);
        asyncOut.end();
        return out.flush();
    });
};