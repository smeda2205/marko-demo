'use strict';

var utils = require('module-config-inc/lib/utils');

var ServiceManager = require('./service-manager').ServiceManager;

var cache = {};

module.exports.instrument = function instrument(transport, moduleRef, wrappers) {
    if (arguments.length === 2 && Array.isArray(moduleRef)) {
        wrappers = moduleRef;
        moduleRef = undefined;
    }
    moduleRef = moduleRef || module;
    var modRoot = utils.moduleRoot(moduleRef);
    var moduleName = utils.moduleName(modRoot);

    var manager = cache[moduleName] || (cache[moduleName] = new ServiceManager(moduleName, moduleRef));
    return manager.instrument(transport, wrappers);
};

module.exports.getServiceManager = function getServiceManager(moduleName) {
    return cache[moduleName];
};