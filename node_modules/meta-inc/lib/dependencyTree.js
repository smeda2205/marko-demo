'use strict';

var shell = require('shelljs');
var fs = require('fs');
var deployEnv = require('environment-ebay');
var path = require('path');

module.exports.getDependencyTree = function getDependencyTree(callback) {
    var root = process.cwd();
    var treePath = path.join(root, 'dependencyTree.json');
    fs.exists(treePath, function(exists) {
        if (exists) {
            return callback(null, treePath);
        }
        if (deployEnv.isDev()) {
            shell.exec('cd ' + root);
            shell.exec('npm ls -json 1> dependencyTree.json  2> /dev/null', {
                silent: true
            }, function(code, output) {
                if (code > 1) {
                    return callback(new Error('error finding dependency tree: exit code:' + code), null);
                }
                return callback(null, treePath);
            });
        } else {
            return callback(new Error('dependency tree file does not exist'), null);
        }
    });
};
