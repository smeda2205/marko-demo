<%
var _nodeMemAvailable = Math.round(hostInfo['Node.js Memory Available']/1e6);
var _nodeMemMaxAvailable = Math.round(hostInfo['Node.js Memory Limits Available']/1e6);
var _nodeMemTotal = Math.round(hostInfo['Node.js Memory Total']/1e6);
var _nodeMemMaxTotal = Math.round(hostInfo['Node.js Memory Limits Total']/1e6);
var _memAvailable = Math.round(hostInfo['Physical Memory Available']/1e6);
var _memTotal = Math.round(hostInfo['Physical Memory Total']/1e6);
%>
<Component name="Host Info" alias="troubleshootinghostinfo" status="Created">
    <Properties>
    <Property name="CPU Usage" warningLevel="<%=80/hostInfo['CPU Usage']%>">
        <![CDATA[ <%=hostInfo['CPU Usage']%>% ]]>
    </Property>
    <Property name="Node Memory Limits (Available / Total)" warningLevel="<%=_nodeMemMaxTotal/(_nodeMemMaxTotal-_nodeMemMaxAvailable+1)%>">
        <![CDATA[ <%=_nodeMemMaxAvailable%>M/<%=_nodeMemMaxTotal%>M ]]>
    </Property>
    <Property name="Node Memory (Available / Total)" warningLevel="<%=_nodeMemMaxTotal/(_nodeMemMaxTotal-_nodeMemMaxAvailable+1)%>">
        <![CDATA[ <%=_nodeMemAvailable%>M/<%=_nodeMemTotal%>M ]]>
    </Property>
    <Property name="Physical Memory (Available / Total)">
        <![CDATA[ <%=_memAvailable%>M/<%=_memTotal%>M ]]>
    </Property>
    <Property name="Pid">
        <![CDATA[ <%=hostInfo.Pid%> ]]>
    </Property>
    <Property name="Workers">
        <![CDATA[ <%=workersHostInfo.length || 1%> ]]>
    </Property>
    <Property name="Worker">
        <![CDATA[ <%=hostInfo.Worker%> ]]>
    </Property>
    </Properties>
</Component>

<% if (workersHostInfo.length > 1) { %>
    <% for(var i=0; i < workersHostInfo.length; i++){
        var info = workersHostInfo[i];
        var nodeMemAvailable = Math.round(info['Node.js Memory Available']/1e6);
        var nodeMemTotal = Math.round(info['Node.js Memory Total']/1e6);
        var nodeMemMaxAvailable = Math.round(info['Node.js Memory Limits Available']/1e6);
        var nodeMemMaxTotal = Math.round(info['Node.js Memory Limits Total']/1e6);
        var memAvailable = Math.round(info['Physical Memory Available']/1e6);
        var memTotal = Math.round(info['Physical Memory Total']/1e6);
        %>
        <Component name="Worker <%=i%> Host Info" alias="troubleshootinghostinfo" status="Created">

            <Properties>
            <Property name="CPU Usage" warningLevel="<%=80/info['CPU Usage']%>">
                <![CDATA[ <%=info['CPU Usage']%>% ]]>
            </Property>
            <Property name="Node Memory Limits (Available / Total)" warningLevel="<%=nodeMemMaxTotal/(nodeMemMaxTotal - nodeMemMaxAvailable + 1) %>">
                <![CDATA[ <%=nodeMemMaxAvailable%>M/<%=nodeMemMaxTotal%>M ]]>
            </Property>
            <Property name="Node Memory (Available / Total)" warningLevel="<%=nodeMemMaxTotal/(nodeMemMaxTotal - nodeMemMaxAvailable + 1) %>">
                <![CDATA[ <%=nodeMemAvailable%>M/<%=nodeMemTotal%>M ]]>
            </Property>
            <Property name="Physical Memory (Available / Total)">
                <![CDATA[ <%=memAvailable%>M/<%=memTotal%>M ]]>
            </Property>
            <Property name="Pid">
                <![CDATA[ <%=info.Pid%> ]]>
            </Property>
            </Properties>
        </Component>

    <% } %>
<% } %>
