'use strict';

require('./');  //init index.js as well
var Objpath = require('object-path');

var PDSHelper = require('./pds-helper');
var logger = require('logging-inc').logger('global-header-ebay/middleware');

module.exports = function eBayGlobalHeader(options) {
    // Future home of global header logic that needs to run earlier
    // in the request handling...

    return function header(req, res, next) {
        var preload = Objpath.get(req, 'route.config.global-header.preload');
        if (preload !== undefined) {
            if (preload === true || preload.pds === true) {
                logger.warn('preloading PDS context for GH');
                PDSHelper.pdsProcessor(req, function (err, attributes) {
                });
            }
        }
        next();
    };
};
