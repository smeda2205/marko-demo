'use strict';

var Cache = require('../../../lib/cache');

Cache.configure({
    enable: true,
    max: 2000,          //Max cache size
    maxAge: 1800000,        //Max Age (30 mins)
    cold: {
        enable: true,
        flushDelay: 1,
        freeDelay: 2500,
        refreshInterval: 50
    }
});

process.on('SIGTERM', function() {
	process.send('done');
	process.exit(1);
});

process.on('message', function (msg) {
    msg = JSON.parse(msg);
    if (msg.type === 'write') {
        setTimeout(function () {
            Cache.toColdCache(msg.name, {
                value: msg.value
            });
            process.send('ok');
        }, 100);
    }
    if (msg.type === 'read') {
        Cache.fromColdCache('foo', function (err, value) {
            process.send(value.value);
        });
    }
});

console.log('process ready');
if(process.send)
    process.send('online');

setTimeout(function () {
    // make the process wait
}, 5000);
