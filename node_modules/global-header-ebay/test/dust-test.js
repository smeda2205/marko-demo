'use strict';
require('request-local');

var chai = require('chai'),
    assert = chai.assert,
    dust;

describe('dust helpers', function () {

    before(function () {
        dust = require('dustjs-linkedin');
        require('../dust').registerHelpers(dust);
        process.env.NODE_ENV = 'test';
    });

    it('header: FULL', function (next) {


        var code = '{@gh-configure layout="FULL" /}<html><head>{@gh-head-css/}</head><body>{@gh-header/}{@gh-body-js/}</body></html>';
        dust.renderSource(code, {dependencies: []}, function (err, out) {
            if (err) {
                return next(err);
            }

            assert.ok(out);
            assert.include(out, 'www.qa.ebay.com');
            assert.include(out, '<link');
            assert.include(out, '<script');
            assert.include(out, 'GH_config={"siteId":"0","geoLang":"[]","qapool":"qa.ebay.com",sin:0');
            next();
        });
    });

    it('header: MIN', function (next) {


        var code = '{@gh-configure layout="MIN" /}<html><head>{@gh-head-css/}</head><body>{@gh-header/}{@gh-body-js/}</body></html>';
        dust.renderSource(code, {dependencies: []}, function (err, out) {
            if (err) {
                return next(err);
            }

            assert.ok(out);
            assert.include(out, 'www.qa.ebay.com');
            assert.include(out, '<link');
            assert.include(out, '#mainContent');
            next();
        });
    });

    it('header: FULL, motor categoryId', function (next) {


        var code = '{@gh-configure layout="FULL" categoryId=6000 secure=1 /}<html><head>{@gh-head-css/}</head><body>{@gh-header/}{@gh-body-js/}</body></html>';
        dust.renderSource(code, {dependencies: []}, function (err, out) {
            if (err) {
                return next(err);
            }

            assert.ok(out);
            assert.include(out, 'www.qa.ebay.com');
            assert.include(out, '<link');
            assert.include(out, '<script');
            next();
        });
    });

    it('header: FULL with searchKeyword', function (next) {


        var code = '{@gh-configure layout="FULL" searchKeywords="nike" /}<html><head>{@gh-head-css/}</head><body>{@gh-header/}{@gh-body-js/}</body></html>';
        dust.renderSource(code, {dependencies: []}, function (err, out) {
            if (err) {
                return next(err);
            }

            assert.ok(out);
            assert.include(out, 'www.qa.ebay.com');
            assert.include(out, '<link');
            assert.include(out, 'nike');
            assert.include(out, '<script');
            next();
        });
    });

    it('header: FULL with searchFormAction', function (next) {


        var code = '{@gh-configure layout="FULL" searchFormAction="/my-custom-search" /}<html><head>{@gh-head-css/}</head><body>{@gh-header/}{@gh-body-js/}</body></html>';
        dust.renderSource(code, {dependencies: []}, function (err, out) {
            if (err) {
                return next(err);
            }

            assert.ok(out);
            assert.include(out, 'www.qa.ebay.com');
            assert.include(out, '<link');
            assert.include(out, 'my-custom-search');
            assert.include(out, '<script');
            next();
        });
    });

    it('footer', function (next) {


        var code = '{@gh-configure layout="FULL" /}{@gh-footer/}{@gh-body-js/}';
        dust.renderSource(code, {dependencies: []}, function (err, out) {
            if (err) {
                return next(err);
            }

            assert.ok(out);
            assert.include(out, 'Copyright');
            assert.include(out, 'pages.qa.ebay.com');
            // assert.include(out, '<link');
            // assert.include(out, '<html');
            next();
        });
    });

    it('header and footer', function (next) {


        var code = '{@gh-configure layout="FULL" /}<html><head>{@gh-head-css/}</head><body>{@gh-header/}{@gh-footer/}{@gh-body-js/}</body></html>';
        dust.renderSource(code, {dependencies: []}, function (err, out) {
            if (err) {
                return next(err);
            }

            assert.ok(out);
            assert.include(out, 'Copyright');
            assert.include(out, 'pages.qa.ebay.com');
            assert.include(out, 'www.qa.ebay.com');
            assert.include(out, '<link');
            assert.include(out, '<script');
            next();
        });
    });

    it('min footer', function (next) {


        var code = '{@gh-configure layout="FULL" footerLayout="MIN" /}<html><body>{@gh-footer/}</body></html>';
        dust.renderSource(code, {dependencies: []}, function (err, out) {
            if (err) {
                return next(err);
            }

            assert.ok(out);
            assert.include(out, 'pages.qa.ebay.com');
            assert.notInclude(out, 'www.qa.ebay.com');
            assert.notInclude(out, '<link');
            assert.notInclude(out, '<script');
            next();
        });
    });
});
