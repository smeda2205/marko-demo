'use strict';

var cal = require('cal'),
    events = require('events'),
    globalHeader = require('../'),
    DataHolder = require('raptor-async/DataHolder'),
    nock = require('nock');

cal.setDefaultWriteStream('console');

describe(__filename, function () {
    var req;
    before(function(){
        req =  new events.EventEmitter();
        req.ebay = {
            experimentation: {}
        };
        req.ebay.ghFactorsPending = new DataHolder();
        req.ebay.ghFactorsPending.resolve(['f1', 'f2']);
        req.ebay.locality = {
            "country": "GB",
            "countryId": 3,
            "isGeoCountry": false,
            "siteId": 3,
            "locale": "en-GB",
            "language": "en",
            "defaultLanguage": "en-GB",
            "supportedLanguages": [
              "en-GB"
            ],
            "directionality": "ltr",
            "isoCurrencyCode": "GBP",
            "siteDefaultIsoCurrencyCode": "GBP",
            "timeZone": "Europe/London",
            "timeZoneStd": "GMT",
            "timeZoneSummer": "BST"
          };
    });
    after(function () {
        nock.cleanAll();
    });

    it('should not have factors as part of url and should use app default = NODE when load header', function (next) {
        

        var svr = nock('http://globalheader.vip.qa.ebay.com')
            .get('/header/json?pool=rand0101&app=NODE&human=0')
            .reply(500, 'Test error');

        
        
        globalHeader.loadHeader(req, {
                pool: 'rand0101'
            },
            function (err, header) {
                

                svr.done();
                next();
            });

    });

    it('should not have factors as part of url and should use app default = NODE when load footer', function (next) {
        

        var svr = nock('http://globalheader.vip.qa.ebay.com')
            .get('/header/footer?pool=rand0101&app=NODE&human=0')
            .reply(500, 'Test error');

        
        globalHeader.loadFooter(req, {
                pool: 'rand0101'
            },
            function (err, header) {
                

                svr.done();
                next();
            });

    });



});
