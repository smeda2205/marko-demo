'use strict';

var cal = require('cal');
var publishers = {};

var publishFactory = exports.publishFactory = function publishFactory(profile) {
    return function publish(statsEvent) {
        if (statsEvent.type === profile) {
            var hb = cal.createHeartbeat('SERVICES', profile);
            hb.addData(statsEvent.message);
            hb.complete();
        }
    };
};

exports.init = function init(type) {
    var publish = publishers[type];
    if (publish) {
        return;
    }
    publish = publishers[type] = publishFactory(type);
    process.on('metrics-stats:cal', publish);
};

exports.reset = function reset(type) {
    var publish = publishers[type];
    delete publishers[type];
    process.removeListener('metrics-stats:cal', publish);
};
