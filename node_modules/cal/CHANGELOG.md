# Next
## v4.0.2
* Adjusted parent context preservation to avoid UNFINISHED transaction increase in CAL

## v4.0.1
* Fixed slow memory leak due to abandoned closing transaction events if they come when the main transaction has already been flushed and no parent transaction left to control flushing.
* Free domain from master transaction after complete
* process.emit should be outside domain to avoid propagation of the context that can lead to memory accumulation

## v4.0.0
* Remove peer and unwanted dependencies and upgrade dependencies

#0.5.40
* Move cal initializtion from commons-inc middleware

#0.5.39
* Recycle threads every 12 hours to mitigate tracking soj loss in case some transaction is not closed properly

#0.5.38
* Fixed: do not buffer heartbeats: https://github.corp.ebay.com/nodejs/node-cal/issues/22
* Fixed: set auto-flush timeout to close unfinished transactions: https://github.corp.ebay.com/nodejs/node-cal/issues/23

#0.5.37
* Removed unused dependencies

#0.5.34
* Switched from continuation local storage to domains as part of preparation to nodejs upgrade

#0.5.33
* Performance optimizations

#0.5.32
* Switched environment-inc to environment-ebay

#0.5.31
 - Fixed: subsequent nested transaction should inherit correct parent transaction. Due to the bug it inherited previous nested transaction.

#0.5.30
 - Fixed: Should clone options passed. This will fix issue in commons-ebay where config bean tries to loop
through circular dependency of cal options created by cal options modification

#0.5.28
 - Fixed ETIMEDOUT issue crashing applications.

#0.5.27
 - re-set domain context for every batch of writes to avoid memory leak.

#0.5.26
 - auto-close unfinished transactions with status=UNFINISHED before flushing to CAL.

#0.5.25
 - cleaning socket all the time on socket close.
 - enabling cal stream error emit code
 - register new logger and queue to domain
 - More error tests

#0.5.24
 - Human friendly threadId in clustering (0x1000, 0x2000, 0x3000 instead of 0x3e8, 0x7d0, 0xbb8 ...)
 - added public_credential in PII filter list
 - disabling cal stream error emit code

#0.5.23
 - using process to send events across instead of creating new Eventemitter

#0.5.22
 - do nothing on cal.stop() if cal is not started

#0.5.21
 - cleaning out the old streams on defaultStream change
 - cal socket timeout back to 1+ min
 - cloning data before deleting as emitting events as well for others to recieve data

#0.5.20
 - removing maxAge from lru-cache to avoid frequent ISS reconnects
 - fixing clustering case for instance = 0

#0.5.19
 - reverting moment dependency back to ~2.4.0

#0.5.18
 - handling case of only one addData('string') as string
 - updating dependencies

#0.5.17
 - accounting PM2 clustering for deciding poolSize as cald_max_publisher_connections_per_pool=10 in cal

#0.5.16
 - reverting cal socket timeout back to 30s.
 - treating strings in addData('string') as array

#0.5.15
 - Remove events from stream queue if queue size is > 20k/connection to accomodate more txns
 - unref timeouts in stream-queue

#0.5.14
 - setting MAX_DELAY_TIME as 500ms while retrying cal connections
 - stream queue is also now backed by LRU cache to avoid lost stream references.

#0.5.13
 - Auto release any zombie root cal transaction after 30s
 - Using LRU cache to store CAL buffers with auto release of 2min.

#0.5.12
 - flag for nested transaction
 - adding email-address in PII keyword list

#0.5.10
 - nested transaction fix

#0.5.10
 - support for magic proxy/managed stage
 - fix serialize JSON with circular dependency

#0.5.9
 - using try-require
 - code optimization
 - enabling mock tests

#0.5.8
 - considering pm2 while generating fakeThreadId
 - threadPoolId will grow based on traffic. For less traffic, using less cal socket connections.

#0.5.7
 - cls fix
 - connection tester fix, only cache resolvedHost once some host actually works.

#0.5.0 to 0.5.4
 - Support for both eBay and PayPal CAL
 - Support for nested transaction
 - handling socket timeouts
 - socket retry for individual writeStream
 - CAL internal queue for backpressure

#0.4.10
 - using setImmediate while dispatching buffered cal events
 - making _streamPool local to Logger instance.
 - removing dead code

#0.4.9
 - Disabling client backpressuring and relying on node to take care of it.
 - Resetting retrylimit when successful connect
 - making cal socket keepAlive=true

#0.4.5
 - In case of cal ECONNREFUSED, also retry.
 - Adding cal debugs (use DEBUG:cal:* to activate)

#0.4.4
 - mockCALServer
 - More tests for mulitple serial or parallel transactions with and without buffering.

#0.4.1
 - Pretty formatter
 - CAL transaction buffering for updating name

#0.4.0
 - Added threadId getter/setter API
 - continuation-local-storage dependency update.

#0.3.2
 - Using threadId=0 for all CAL heartbeats

#0.3.1
 - fixed the appname and manifest file lookup path

#0.3.0
 - support for `silent` formatter.

#0.2.11 - 20131220
 - serializing 1st level JSON object in cal payload.
 - Added new line character for cal format used with console stream.
 - Tests for console, JSON and CAL URL transaction with test events.

#0.2.10 - 20131218
 - fixing SQLLog format as per CAL team suggestion.

#0.2.9 - 20131209
 - remove warnings about missing package.json/manifest.json.
 - Fixing checkstyle issues.

#0.2.8 - 20131202
 - continuation-local-storage dependency update.
 - console.logging for missing package.json and manifest.json lookup.

#0.2.7 - 20131125
 - Added serialization of Error object in CAL formatter.
