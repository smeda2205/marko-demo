BASE = .
REPORTER = spec
MOCHA = ./node_modules/.bin/mocha
_MOCHA = ./node_modules/.bin/_mocha
JSHINT = ./node_modules/.bin/jshint
ISTANBUL = ./node_modules/.bin/istanbul

all: clean lint test

test:
	@NODE_ENV=test DEPLOY_ENV=test $(MOCHA) \
		--reporter $(REPORTER) --timeout 10000 test/*.js

coverage:
	@NODE_ENV=test DEPLOY_ENV=test $(ISTANBUL) cover --dir gh-pages/coverage $(_MOCHA) \
		-- --reporter $(REPORTER) --timeout 20000  test/*.js

lint:
	$(JSHINT) ./lib --config $(BASE)/.jshintrc && \
	$(JSHINT) ./test --config $(BASE)/.jshintrc

clean:
	rm -rf  ./.beans ./.cache

.PHONY: coverage test docs