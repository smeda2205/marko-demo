# ChangeLog

## v4.0.15
* Increase SIFR abort timeout to 5 seconds to support slow internet connection cases.

## v4.0.14
* Fixed: Issue while deploying to Altus - http://resreposvc.vip.ebay.com:80 down, https://jirap.corp.ebay.com/browse/RAPTORSUP-779

## v4.0.13
* Changed JSON to HeaderMultiValue for Headers logging to CAL

## v4.0.12
* Added a flag to disable COS 2.0 XFF feature for services that are not ready. One of them is esams legacy service.

## v4.0.11
* Added: log request headers into CAL in case of error, https://jirap.corp.ebay.com/browse/NODE-891
* Implemented x-forwarded-for per COS 2.0 spec: https://wiki.vip.corp.ebay.com/pages/viewpage.action?spaceKey=ARCH&title=End+to+End+Support+for+ClientIP+using+XFF#tabs-notification-2, https://jirap.corp.ebay.com/browse/NODE-1366
* Fixed: metrics disappeared for platform modules, https://jirap.corp.ebay.com/browse/NODE-1396
* Fixed: should show custom instruments if used in corresponding service config bean

## v4.0.10
* Added context method specific to ebay platform context

## v4.0.9
 * Added feature for converting short vip/stratus to FQDN
 * Added config for some known hosts
 * Made tracking handler configurable to control where the tracking data should come from response headers or chunk

## v4.0.8
* http-api should use only isomorphic functionality as it is used in browser as well

## v4.0.7
* Fix: service-instruments-ebay: no response/error received after retry for legacy pipelines, https://jirap.corp.ebay.com/browse/NODE-1254
* Fix: service-client-ebay via http-api instrument suppresses uncaught errors, https://jirap.corp.ebay.com/browse/NODE-1250

## v4.0.6
* Fix: config does not pass configuration to other handlers, https://jirap.corp.ebay.com/browse/NODE-1241

## v4.0.5
* Integrated with trooba-hystrix-handler
* Added mock transport for easy mocking for app developers
* Added fallback method to http API
* Added hystrix metrics publishing to sherlock
* Fixed: service-client-ebay should clear up an error count after successful call - https://github.corp.ebay.com/nodejs/instrument-inc/issues/28
* Fixed: service-instrument-ebay/circuit does not honor config bean changes - https://jirap.corp.ebay.com/browse/NODE-1114

## v4.0.3
* Fixed retry logic to clone the original request object for retry attempt
* Corrected unit tests

## v4.0.2
* Don't overwrite error.type if it is set to any value other than error.

## v4.0.1
* Lazy initialize MetricsServices to avoid cycles

## v4.0.0
* Update depenendcies that bring in peer dependencies

## v1.0.2
* Fixed: RuntimeError should allow to overwrite message attribute.

## v1.0.1
* Fixed: error handler should not re-set error message; it should wrap error into a new error with message that contains url metadata. This would prevent uncaught errors when they are frozen.
* Circuit handler should not auto-mark up a service that was manually marked down (Verified with unit-test)
* Soap handler should correctly format error message received from backend when multiple errors come.

## v2.0.0
* Renamed the module
* Deprecated instruments-ebay and instruments-inc
* Refactored to [Trooba framework](https://github.com/trooba/trooba)
* Added multipart json transport

## instruments-ebay@2.0.0 and instruments-inc
* Merged instrument-ebay/inc to service-instruments-ebay and refactored to adhere to [trooba framework](https://github.com/trooba)
* Upgraded to service-client-ebay@2+
* Removed dependencies on servicecore
* Removed instrument and transport registry. Now it dynamically resolves instruments

## v1.0.7
* Enhancement: HTTPS instrument to access services using eBay Root certificate or Self Signed certificate for SSL setup.

## v1.0.6
* Fixed: added scopes to getRecognizedUserToken and getPublicRecognizedUserToken.

## v1.0.5
* Fixed: should handle error passed in the response body, https://github.corp.ebay.com/nodejs/instrument-ebay/issues/39
* Fixed: should pass http error status code when fail to parse the body in case the service returns non XML response

## v1.0.4
* Fixed: oauth instrument should not fail with NPE due to bad scope in tolerant/browser mode: https://jirap.corp.ebay.com/browse/NODE-310
* Corrected OPTIN_COOKIE unit tests that started failing due to changes in ep module

## v1.0.3
* Removed unused dependencies

## v1.0.2
* Added initial support for browser instrumentation

## v0.2.2
* Added initial support for browser instrumentation

## v0.2.1
* Added metrics for soap instrument to measure marshaling/unmarshaling

## v0.2.2
* Fixed request-local dependency

## v0.2.1
* Fixed: Instrumentation w/Errors

## v0.2.0
* Enhancement: Enabled EP instrumentation for Experience Services
* Fixed: Instrumentation w/Errors

## v0.1.16
* Enhancement: Enabled EP instrumentation for Experience Services

## v0.1.15
* Fixed: Formatted EP Header values
* Fixed: Added SSE Tracking Header Support

## v0.1.14
* Fixed: Sending right Headers from EP

## v0.1.13
* Added function to reset soap clients.
* Fixed: soap should correctly handle error.

## v0.1.12
* Added missing cache instrument registration.

## v0.1.11
* Added soap instrument

## v0.1.10
* Added cache instrument

## v0.1.9
* Added error attributes per COS 2.0

## v0.1.8
* Fixed: wrapping runtime into runtime fails.
* Added: more unit tests for error property inheritance

## v0.1.7
* Added support for giving specific scope per token request.
* Added RuntimeError class to simplify wrapping of generic errors with instrumentation like type, code, statusCode and preserving the original stack while allowing to capture post async call stack trace.

## v0.1.6
* Provides standard ebay instrumentation for generic transports.
* You can define your own transport and have it instrumented via [service-client-ebay module](https://github.corp.ebay.com/nodejs/service-client-ebay).
    Transport interface:

    ```javascript
    function epsTransportFactory() {
      return function epsTransport(options, callback) {
        // do something here
        callback(err, response);
      };
    }
```
* You can define your instrument and register it for others to use: https://github.corp.ebay.com/nodejs/instrument-inc#registration
