'use strict';

var Objutil = require('objutil');
var httpfy = require('./http-api');

module.exports = function transport(pipe, config) {
    pipe.on('request', function onRequest(request) {

        var options = request;
        config && Objutil.merge(config, options);

        if (!options.mockData) {
            throw new Error('Cannot find mock data for ' + pipe.context.clientId);
        }

        const data = (typeof options.mockData === 'string' ?
            require(options.mockData) : options.mockData);

        setImmediate(() => {
            pipe.respond(data);
        });
    });

    httpfy(pipe);
};
